# Ichime

Нативное приложение для сайта Anime 365, созданное специально для iPhone, iPad и Apple TV.

## Скриншоты

Скриншоты с iPhone, iPad и Apple TV можно найти на странице [Wiki → Скриншоты](https://github.com/midori-no-me/ichime/wiki/Скриншоты).

## Возможности приложения

Приложение покрывает все базовые сценарии пользования сайтом, касающиеся именно просмотра сериалов.

Плеер:

- Системный плеер — такой же, как в Safari и приложении "TV".
- Поддержка субтитров. Поддерживаются только субтитры в формате WebVTT.
- Поддержка AirPlay. Но без внешних субтитров.
- Внутри плеера отображается название сериала и номер серии.
- Если досмотреть серию до конца, то она автоматически будет отмечена просмотренной. Так же, как это сделано на сайте.

Ваша библиотека:

- Выводим список следующих серий к просмотру так же, как на сайте они выводятся в секции "Серии к просмотру".
- Раздел уведомлений с сайта, в котором отображается список вышедших недавно серий или сериалов. Но push-уведомления отправлять пока не умеем.
- Если перейти на страницу сериала, то его можно добавить в свой список.

Каталог сериалов:

- Список онгоингов.
- Поиск.
- Просмотр базовой информации о сериале.

## Как скачать

### iPhone и iPad

По понятным причинам приложения нет в App Store. Его можно установить можно через [AltStore](https://altstore.io), [Sideloadly](https://sideloadly.io) или аналогичный софт. Для этого вам потребуется компьютер на macOS или Windows.

#### Как установить через AltStore

Для установки потребуется macOS или Windows, а также устройство под управлением iOS или iPadOS версии 17.0 или новее. Ваши компьютер и мобильные устройства должны находиться в одной сети, например, быть подключены к одному домашнему Wi-Fi.

1. Скачайте файл с расширением `.ipa` у самого последнего релиза на странице [Releases](https://github.com/midori-no-me/ichime/releases) на iPhone или iPad.
2. Установите AltStore на компьютер по [официальной инструкции](https://faq.altstore.io). В этой же инструкции будет написано, как установить его на iPhone и iPad.
3. Откройте AltStore на вашем iPhone или iPad, в нижнем меню выберите вкладку "My Apps" (Мои Приложения).
4. В верхнем меню нажмите на кнопку "+" и выберите сохраненный ранее файл с расширением `.ipa`.
5. AltStore начнёт установку приложения на ваше устройство. Если потребуется, введите данные вашего Apple ID для подписи приложения.

Приложение установлено, но при его запуске вы увидите ошибку. Чтобы ее не было, нужно:

1. Заходим в приложение с настройками системы → "Основные" → "Управление устройством".
2. Находим ваш Apple ID в списке и нажимаем на него.
3. Нажимаем "Доверять" и подтверждаем.

Теперь приложение должно работать корректно.

> [!IMPORTANT]  
> Приложения, установленные через AltStore или любым другим аналогичным способом, нужно обновлять каждые 7 дней. Это ограничение Apple. Просто откройте AltStore и обновите приложения в разделе "Мои приложения". Во время этого процесса ваш компьютер и мобильные устройства должны находиться в одной сети, например, быть подключены к одному домашнему Wi-Fi, а на компьютере должен быть запущен AltStore. Приложение AltStore на вашем телефоне уведомит вас о том, что пора обновлять приложения. Вы также можете автоматизировать этот процесс через приложение "Команды" на вашем iPhone или iPad.

### Apple TV

Для установки на Apple TV требуется [Sideloadly](https://sideloadly.io) или любой другой аналогичный софт, поддерживающий Apple TV. Поддерживается tvOS 17.0 или новее. Для установки вам потребуется компьютер на macOS или Windows.

### macOS

Эта версия пока в разработке.

## Архитектура

Приложение построено на SwiftUI и AVKit.

### Взаимодействие с сайтом

У сайта есть HTTP API, но там поддерживаются не все возможности — только read-only запросы.

Все запросы с сессией пользователя, а также запросы, мутирующие состояние сервера, выполняются не к API, а к самому сайту — так, будто бы это запросы из браузера. Это значит, что некоторые данные получаются путем парсинга HTML самого сайта.

### Субтитры

На сайте субтитры распространяются в формате `.vtt` ([WebVTT](https://en.wikipedia.org/wiki/WebVTT)), поэтому мы их передаем в видео-плеер как есть.

Так как WebVTT субтитры сайт генерирует автоматически на основе других субтитров (ASS или SRT), то в некоторых переводах, особенно где переводят надписи на экране, возможен не очень красивый рендеринг субтитров.
