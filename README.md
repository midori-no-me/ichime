# Ichime

Нативное приложение для сайта Anime 365, созданное специально для iOS и iPadOS.

## Скриншоты

<details>
<summary>iPhone</summary>
<img src="https://github.com/midori-no-me/ichime/assets/12474739/1b41d896-4695-415e-94a8-a49fc7a18ecb" width="393" height="852">
<img src="https://github.com/midori-no-me/ichime/assets/12474739/95b50bf5-97f8-4aab-bcec-49cf6875d948" width="393" height="852">
<img src="https://github.com/midori-no-me/ichime/assets/12474739/b3524b4c-1781-40e8-9e90-0f2d3d568457" width="393" height="852">
<img src="https://github.com/midori-no-me/ichime/assets/12474739/4155ee84-dbbf-4229-943f-48125b3065d6" width="393" height="852">
<img src="https://github.com/midori-no-me/ichime/assets/12474739/07eb2b25-54d7-444e-a62a-4137c3a52c62" width="393" height="852">
<img src="https://github.com/midori-no-me/ichime/assets/12474739/5b632026-edc6-4888-81b5-49429c82868e" width="393" height="852">
<img src="https://github.com/midori-no-me/ichime/assets/12474739/f2a9896a-677d-4ada-bfc9-dcd55f51811e" width="393" height="852">
<img src="https://github.com/midori-no-me/ichime/assets/12474739/7261729d-56aa-4178-927f-e66fc873edef" width="393" height="852">
</details>

## Возможности приложения

Плеер:

- Нативный плеер — такой же, как в Safari и приложении "TV"
- Поддержка субтитров
- Поддержка AirPlay
- Плеер показывает название тайтла и номер серии внутри
- Серия автоматически помечается просмотренной, когда вы ее досмотрите до конца

Ваша библиотека:

- Вы можете посмотреть список всех новых серий, которые вы еще не посмотрели
- Если перейти на страницу тайтла, то его можно добавить в свой список

Каталог тайтлов:

- Поиск
- Список онгоингов
- Просмотр базовой информации о тайтле

Мы не ставили перед собой задачу полностью покрыть все возможности сайта. Только минимально необходимый минимум, который покрывает большинство потребностей. Но если чего-то не хватает, то пишите.

## Как скачать

### iOS и iPadOS

По понятным причинам приложения нет в App Store. Его можно установить можно через [AltStore](https://altstore.io), [Sideloadly](https://sideloadly.io) или аналогичный софт. Для этого вам потребуется компьютер на macOS или Windows.

#### Как установить через AltStore

Для установки потребуется macOS или Windows, а также устройство под управлением iOS или iPadOS версии 17.0 или новее. Ваш компьютер и мобильные устройства должны находиться в одной сети, например, быть подключены к одному домашнему Wi-Fi.

1. Скачайте файл с расширением `.ipa` у самого последнего релиза на странице [Releases](https://github.com/midori-no-me/ichime/releases) на iPhone или iPad.
2. Установите AltStore на компьютер по [официальной инструкции](https://faq.altstore.io). В этой же инструкции будет написано, как установить его на iPhone и iPad.
3. Откройте AltStore на вашем iPhone или iPad, в нижнем меню выберите вкладку "My Apps" (Мои Приложения).
4. В верхнем меню нажмите на кнопку "+" и выберите сохраненный ранее файл с расширением `.ipa`.
5. AltStore начнёт установку приложения на ваше устройство. Если потребуется, введите данные вашего Apple ID для подписи приложения.

Приложение установлено, но при его запуске вы увидите ошибку. Чтобы ее не было, нужно:

1. Заходим в приложение с настройками системы > "Основные" > "Управление устройством".
2. Находим ваш Apple ID в списке и нажимаем на него.
3. Нажимаем "Доверять" и подтверждаем.

Теперь приложение должно работать корректно.

> [!IMPORTANT]  
> Приложения, установленные через AltStore или любым другим аналогичным способом, нужно обновлять каждые 7 дней. Это ограничение Apple. Просто откройте AltStore и обновите приложения в разделе "Мои приложения". Во время этого процесса ваш компьютер и мобильные устройства должны находиться в одной сети, например, быть подключены к одному домашнему Wi-Fi, а на компьютере должен быть запущен AltStore. Приложение AltStore на вашем телефоне уведомит вас о том, что пора обновлять приложения. Вы также можете автоматизировать этот процесс через приложение "Команды" на вашем iPhone или iPad.

### macOS

Эта версия пока в разработке.

### tvOS

Эта версия пока в разработке.

## Архитектура

Приложение построено на SwiftUI и AVKit.

### Взаимодействие с сайтом

У сайта есть HTTP API, но там поддерживаются не все возможности - только read-only запросы.

Все запросы с сессией пользователя, а также запросы, мутирующие состояние сервера, выполняются не к API, а к самому сайту - так, будто бы это запросы из браузера. Это значит, что некоторые данные получаются путем парсинга HTML самого сайта.

### Субтитры

На сайте субтитры распространяются в формате `.vtt` ([WebVTT](https://en.wikipedia.org/wiki/WebVTT)), поэтому мы их передаем в видео-плеер как есть.

Так как WebTT субтитры сайт генерирует автоматически на основе других субтитров (ASS или SRT), то в некоторых переводах, особенно где переводят надписи на экране, возможен не очень красивый рендеринг субтитров.
